<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script src="https://cdn.bootcss.com/angular.js/1.6.4/angular.min.js"></script>
    <script src="https://cdn.bootcss.com/angular.js/1.6.4/angular-resource.min.js"></script>
</head>
<body ng-controller="mainCtrl">

<script>
    angular.module('app', ['ngResource'])
        .controller('mainCtrl', ['$scope', '$http', function ($scope, $http) {
            var url = location.href.split('#')[0];
//            url = encodeURIComponent(url)
            $http({
                method: 'POST',
                url: 'http://wjh.tunnel.qydev.com/execution/api/auth/wxJsConfig',
                data: {data: url}
            }).then(function (res) {
                var config = res.data;
//                config.debug = true;
                config.jsApiList = ['JSAPI', 'chooseImage'];
                wx.config(config);
                wx.ready(function () {
                    wx.chooseImage({
                        count: 1, // 默认9
                        success: function (res) {
                            var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                            localIds.forEach(localId = > {
                                wx.uploadImage({
                                localId: localId, // 需要上传的图片的本地ID，由chooseImage接口获得
                                isShowProgressTips: 1, // 默认为1，显示进度提示
                                success: function (res) {
                                    var serverId = res.serverId; // 返回图片的服务器端ID
                                    alert(serverId);
                                }
                            });
                        })
                        }
                    });
                });
                wx.error(function (res) {
                    alert(res)
                });
            });
        }])
</script>
</body>
</html>